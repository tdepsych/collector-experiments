<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    <link rel="stylesheet" href="../../collector-experiments/User/Assets/MSc/global_css.css">
    <script src="https://tdepsych.github.io/gorilla-materials/wordsearch.js"></script>
    <style>
      #collector_phase_timer {
        display: none;
      }
      .ws-area {
        background: #FFF;
        border-style: solid;
        border-color: #000!important;
      }
      #ws-score {
        font-weight: bold;
        padding-bottom: 25px;
      }
      /* Moving New Game Button */
      .ws-new-game {
        margin-top: -60px;
        margin-right: -450px;
      }
      /* Styling Below Manages the Progress Bar */
      .progressbar {
        position: relative;
        top: 95%;
        width: 55%;
        margin-left: 218px;
        border: solid 1px #000;
      }
      .progressbar .inner {
        height: 15px;
        animation: progressbar-countdown;
        /* Placeholder, this will be updated using javascript */ 
        animation-duration: 40s;
        /* We stop in the end */
        animation-iteration-count: 1;
        /* Stay on pause when the animation is finished finished */
        animation-fill-mode: forwards;
        /* We start paused, we start the animation using javascript */
        animation-play-state: paused;
        /* We want a linear animation, ease-out is standard */
        animation-timing-function: linear;
      }
      @keyframes progressbar-countdown {
        0% {
          width: 100%;
          background: #d2fcd2;
        }
        100% {
          width: 0%;
          background: #fcd2d2; 
        }
      } 
      .ws-words {
        display: none!important;
      }
    </style>
  </head>
  <body>
    <!--<input type="hidden" name="ws_score" id="ws_score"/>-->
    <!--<input type="hidden" name="ws_remaining" id="ws_remaining"/>-->
    <!--<input type="hidden" name="ws_total_time" id="ws_total_time"/>-->
    <button id="zoomOut" tabindex="-1"></button>
    <button id="zoomIn" tabindex="-1"></button>
    <div id="container">
      <div id="mysearchtask"></div>
      <div id='progressbar1'></div>
      
      <script>
      Phase.set_timer(function(){Phase.submit()},300000);
        // This code was adapted from a Qualtrics Wordsearch created by QuentinAndre - https://github.com/QuentinAndre/WordSearchJS
        // Wordsearch puzzle from https://www.puzzles.ca/word-search
        // This creates the progress bar
        Phase.set_timer(function(){
          function createProgressbar(id, duration, callback) {
            // We select the div that we want to turn into a progressbar
            var progressbar = document.getElementById(id);
            progressbar.className = 'progressbar';
            // We create the div that changes width to show progress
            var progressbarinner = document.createElement('div');
            progressbarinner.className = 'inner';
            // Now we set the animation parameters
            progressbarinner.style.animationDuration = duration;
            // Eventually couple a callback
            if (typeof(callback) === 'function') {
              progressbarinner.addEventListener('animationend', callback);
            }   
            // Append the progressbar to the main progressbardiv
            progressbar.appendChild(progressbarinner);
            // When everything is set up we start the animation
            progressbarinner.style.animationPlayState = 'running';
          }
          createProgressbar('progressbar1', '300s'); // If you want to change how long the bar lasts, alter the '180s' (it's total seconds)
        },1);
        
        var countrygrid = [
        ['J', 'O', 'I', 'X', 'O', 'R', 'H', 'F', 'Y', 'B', 'K', 'L', 'L', 'Y', 'D', 'N', 'W', 'T', 'W', 'F'],
        ['U', 'A', 'L', 'V', 'M', 'I', 'X', 'G', 'U', 'N', 'V', 'P', 'T', 'O', 'O', 'H', 'S', 'N', 'E', 'S'],
        ['G', 'X', 'E', 'T', 'A', 'A', 'F', 'Z', 'O', 'C', 'E', 'B', 'T', 'U', 'U', 'A', 'D', 'C', 'F', 'N'],
        ['O', 'H', 'K', 'M', 'F', 'H', 'D', 'T', 'D', 'K', 'K', 'T', 'L', 'D', 'F', 'T', 'K', 'I', 'U', 'Y'],
        ['J', 'I', 'L', 'Y', 'I', 'C', 'C', 'X', 'O', 'U', 'Z', 'C', 'A', 'K', 'E', 'T', 'K', 'X', 'D', 'H'],
        ['T', 'Y', 'I', 'J', 'N', 'R', 'A', 'J', 'S', 'P', 'C', 'D', 'I', 'O', 'G', 'R', 'R', 'L', 'G', 'V'],
        ['P', 'A', 'S', 'Z', 'C', 'R', 'C', 'V', 'T', 'D', 'J', 'X', 'Y', 'V', 'V', 'I', 'T', 'E', 'E', 'A'],
        ['L', 'X', 'G', 'I', 'E', 'H', 'L', 'S', 'A', 'K', 'A', 'M', 'V', 'I', 'Q', 'D', 'C', 'T', 'A', 'X'],
        ['N', 'T', 'K', 'K', 'D', 'S', 'I', 'Y', 'R', 'K', 'T', 'X', 'S', 'Z', 'I', 'I', 'U', 'R', 'F', 'H'],
        ['S', 'L', 'A', 'P', 'B', 'H', 'P', 'N', 'L', 'U', 'S', 'T', 'S', 'C', 'P', 'H', 'N', 'I', 'I', 'O'],
        ['T', 'J', 'E', 'I', 'H', 'I', 'D', 'E', 'B', 'T', 'N', 'S', 'M', 'O', 'X', 'I', 'R', 'L', 'R', 'K'],
        ['T', 'Y', 'R', 'C', 'P', 'T', 'K', 'O', 'O', 'B', 'A', 'U', 'E', 'R', 'E', 'D', 'H', 'F', 'E', 'R'],
        ['K', 'D', 'T', 'R', 'I', 'N', 'S', 'E', 'N', 'L', 'J', 'S', 'D', 'K', 'Q', 'V', 'L', 'S', 'A', 'I'],
        ['N', 'I', 'Y', 'J', 'E', 'F', 'J', 'P', 'G', 'I', 'I', 'P', 'L', 'E', 'A', 'U', 'I', 'G', 'L', 'W'],
        ['B', 'C', 'O', 'C', 'K', 'K', 'H', 'P', 'Y', 'W', 'R', 'P', 'K', 'C', 'O', 'X', 'E', 'L', 'H', 'E'],
        ['C', 'G', 'D', 'W', 'R', 'Q', 'A', 'V', 'C', 'P', 'B', 'G', 'T', 'F', 'Y', 'Z', 'V', 'O', 'Z', 'B'],
        ['A', 'I', 'J', 'C', 'W', 'U', 'U', 'B', 'U', 'U', 'R', 'Z', 'W', 'R', 'P', 'E', 'R', 'A', 'T', 'H'],
        ['X', 'E', 'Z', 'M', 'Q', 'R', 'D', 'E', 'W', 'X', 'Q', 'I', 'T', 'R', 'A', 'E', 'F', 'T', 'L', 'Q'],
        ['P', 'X', 'L', 'S', 'I', 'C', 'K', 'D', 'U', 'U', 'N', 'I', 'A', 'R', 'T', 'S', 'M', 'I', 'U', 'L'],
        ['N', 'R', 'A', 'D', 'Z', 'U', 'U', 'K', 'Y', 'V', 'F', 'T', 'Y', 'G', 'U', 'V', 'H', 'X', 'F', 'W']];

        // Then we set up the list of words (countries) to find    
        var countrynames = ['BAKE', 'BIRD', 'BITCH', 'BOOK', 'CAKE', 'CHAIR', 'CHIN', 'COCK', 'CORK', 'CRIME', 'DEBT', 'DIRT', 'EVIL', 'FIRE', 'FLIRT', 'FOUL', 'FUCK', 'GLASS',
        'GRIN', 'JOKE', 'KNOT', 'LUST', 'NUDE', 'RAGE', 'RAIN', 'RINSE', 'SHIP', 'SHIT', 'SICK', 'SILK', 'SLAP', 'STAR', 'TRASH', 'WHORE', 'WISE', 'DARN', 'FECK', 'FUDGE', 'RUDDY', 'SHOOT'];
        
        var script = document.createElement('script'); 
        script.src = "https://tdepsych.github.io/gorilla-materials/wordsearch.js"
        
        // Set a load of actions to run when the script above is run
        // (I'm not 100% sure what the random array stuff is doing beyond monitoring for correct responses & time taken)
        
        script.onload = function() {
          //alert("Script loaded and ready");
          function getRandom(arr, n) {
            var result = new Array(n),
            len = arr.length,
            taken = new Array(len);
            if (n > len)
            throw new RangeError("getRandom: more elements taken than available");
            while (n--) {
              var x = Math.floor(Math.random() * len);
              result[n] = arr[x in taken ? taken[x] : x];
              taken[x] = --len in taken ? taken[len] : len;
            }
            return result;
          }
        }
        var rounds = 0;
        var username = $("#participant_code").val();
        // parent.parent.phaseNo = 1;
    Phase.set_timer(function(){
        ws = new WordSearch({
          "grid": countrygrid,        // Your grid to search
          "words": countrynames,      // The list of words to find
          "numberOfWordsToFind": 40,   // The number of words to show from words for each game, defaults to all of them
          "parentId": "mysearchtask", // The name of the HTML div to replace with the wordsearch
          "onFindWord": function() {  // When a word is found...
              var array = this.getTiming(); // This assigns the response times to a variable
              array = array.filter(function(x){ return x > -1 }); // This removes any value of -1 from the array
              var lrgst = Math.max(...array)
              array2 = array.filter(e => e != lrgst);
              var secLrgst = Math.max(...array2);
              if (this.getRemaining()==19){
              var indTime = lrgst;
              } else {
                var indTime = lrgst - secLrgst;
              }
              var ws_Score = this.getScore();
              var ws_arrayScore = ws_Score - 1;
              console.log(ws_Score);
              parent.parent.wordsFound = ws_Score + rounds;
              var word_found = $(".ws-word-found").map(function(){return $(this).attr("id");}).get().sort();
            if (this.getScore() == 1) {
              $("#ws_score").val("1")
          Phase.add_response({
                username: parent.parent.$("#participant_code").val(),
                // phase_number: parent.parent.phaseNo,
                ws_score: this.getScore(),
                ws_remaining: this.getRemaining(),
                ws_total_time: Math.max(lrgst),
                ws_individual_time: Math.max(lrgst),
                ws_word: word_found
              })
            } else {
              $("#ws_score").val(ws_Score)
              parent.parent.phaseNo += 1;
              Phase.add_response({
                username: parent.parent.$("#participant_code").val(),
                // phase_number: parent.parent.phaseNo,
                ws_score: this.getScore(),
                ws_remaining: this.getRemaining(),
                ws_total_time: Math.max(lrgst),
                ws_individual_time: Math.max(indTime),
                ws_word: word_found
              })
            }
            if (this.getRemaining()==0){
              //  Put whatever you want ppt. to do next below...
              //var script;
              //rounds += 10;
              Phase.submit()
            }
            
          }   // This closes the "OnFindWord" command
        });
        
    },10);    
        // This part says that if all words are found, move to the next page
        
        document.head.appendChild(script)
  </script>
<script src="../../collector-experiments/User/Assets/MSc/zoom_script.js"></script>      
    </div>
  </body>
</html>